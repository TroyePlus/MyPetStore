<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
 <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="../css/style.css" type="text/css"/>
        <link rel="stylesheet" href="../assets/css/ace.min.css" type="text/css"/>
        <link rel="stylesheet" href="../assets/css/font-awesome.min.css" type="text/css"/>
        <link href="../Widget/icheck/icheck.css" rel="stylesheet" type="text/css" />
		<!--[if IE 7]>
		  <link rel="stylesheet" href="../assets/css/font-awesome-ie7.min.css" type="text/css"/>
		<![endif]-->
        <!--[if lte IE 8]>
		  <link rel="stylesheet" href="../assets/css/ace-ie.min.css" type="text/css"/>
		<![endif]-->
	    <script src="../js/jquery-1.9.1.min.js" type="text/javascript"></script>
        <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../assets/js/typeahead-bs2.min.js" type="text/javascript"></script>
       
		<!-- page specific plugin scripts -->
		<script src="../assets/js/jquery.dataTables.min.js" type="text/javascript"></script>
		<script src="../assets/js/jquery.dataTables.bootstrap.js" type="text/javascript"></script>
        <script type="text/javascript" src="../js/H-ui.js"></script>
        <script type="text/javascript" src="../js/H-ui.admin.js"></script>
        <script src="../assets/layer/layer.js" type="text/javascript" ></script>
        <script src="../assets/laydate/laydate.js" type="text/javascript"></script>
         <script src="../assets/dist/echarts.js" type="text/javascript"></script>
         <script src="../js/lrtk.js" type="text/javascript"></script>
<title>品牌管理</title>
</head>

<body>
<div class="page-content clearfix">
  <div id="brand_style">
    <div class="search_style">
     
      <ul class="search_content clearfix">
       <li><label class="l_f">产品名称</label><input name="" type="text" id="txt_search" class="text_add" placeholder="输入品牌名称"  style=" width:250px"/></li>
<!--       <li><label class="l_f">添加时间</label><input class="inline laydate-icon" id="start" style=" margin-left:10px;"></li>-->
       <li style="width:90px;"><button type="button" class="btn_search" id="btn_search" onclick="product_List(1,10,$('#txt_search').val())"><i class="icon-search"></i>查询</button></li>
      </ul>
    </div>
     <div class="border clearfix">
       <span class="l_f">
        <a href="/backstage/newProductForm" title="添加产品" class="btn btn-warning Order_form"><i class="icon-plus"></i>添加品牌</a>
        <a href="javascript:void(0)" class="btn btn-danger"><i class="icon-trash"></i>批量删除</a>
       </span>
       <span class="r_f">共：<b id="total_num"></b>种产品</span>
     </div>
    <!--品牌展示-->
     <div class="brand_list clearfix" id="category">
     <div class="show_btn" id="rightArrow"><span></span></div>
     <div class="chart_style side_content">
     <div class="side_title"><a title="隐藏" class="close_btn"><span></span></a></div>
         <div id="main" style="height:400px;" class="side_list"></div>
     </div>
     <!--品牌列表-->
         <div class="table_menu_list">
             <table class="table table-striped table-bordered table-hover" id="sample-table">
                 <thead>
                 <tr>
                     <th width="25px"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                     <th width="80px">产品ID</th>
<!--                     <th width="50px">排序</th>-->
                     <th width="120px">图片</th>
                     <th width="120px">名称</th>
                     <th width="130px">分类</th>
                     <th width="250px">描述</th>
<!--                     <th width="180px">加入时间</th>-->
                     <th width="70px">状态</th>
                     <th width="200px">操作</th>
                 </tr>
                 </thead>
                 <tbody id="search_result">
                 </tbody>
             </table>
         </div>
         <div id="page_info" class="page">
             <nav aria-label="Page navigation">
                 <ul class="pagination" id="page">
                     <li><a href="#">首页</a></li>

                     <!--上一页-->
                     <li>
                         <a href="#" aria-label="Previous">
                             <span aria-hidden="true">«</span>
                         </a>
                     </li>

                     <!--循环遍历连续显示的页面，若是当前页就高亮显示，并且没有链接-->
                     <li class="active">
                         <a href="#">2</a>
                     </li>
                     <li>
                         <a href="#">3</a>
                     </li>
                     </th:block>

                     <!--下一页-->
                     <li>
                         <a href="#" aria-label="Next">
                             <span aria-hidden="true">»</span>
                         </a>
                     </li>

                     <li><a href="#">尾页</a></li>
                 </ul>
             </nav>
         </div>
     </div>
  </div>
</div>
</body>
</html>
<script type="text/javascript">
	
jQuery(function($) {
		// var oTable1 = $('#sample-table').dataTable( {
		// "aaSorting": [      //[[...]]之间的表达式在thymeleaf被认为是内联表达式，会渲染错误
		//     [ 1, "desc" ]
        // ],//默认第几个排序
		// "bStateSave": true,//状态保存
		// "aoColumnDefs": [
		//   //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
		//   {"orderable":false,"aTargets":[0,1,3,4,5,6,8,9]}// 制定列不参与排序
		// ] } );
				
				
				$('table th input:checkbox').on('click' , function(){
					var that = this;
					$(this).closest('table').find('tr > td:first-child input:checkbox')
					.each(function(){
						this.checked = that.checked;
						$(this).closest('tr').toggleClass('selected');
					});
						
				});
			

				$('[data-rel="tooltip"]').tooltip({placement: tooltip_placement});
				function tooltip_placement(context, source) {
					var $source = $(source);
					var $parent = $source.closest('table');
					var off1 = $parent.offset();
					var w1 = $parent.width();

					var off2 = $source.offset();
					var w2 = $source.width();

					if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
					return 'left';
				}
			});

$(window).load( function(){
    product_List(null)
} );


//初始化宽度、高度  
 $(".chart_style").height($(window).height()-215);
  $(".table_menu_list").height($(window).height()-215);
  $(".table_menu_list ").width($(window).width()-440);
  //当文档窗口发生改变时 触发  
    $(window).resize(function(){
	 $(".chart_style").height($(window).height()-215);
	 $(".table_menu_list").height($(window).height()-215);
	 $(".table_menu_list").width($(window).width()-440);
	});	
	//图层隐藏限时参数		 
$(function() { 
	$("#category").fix({
		float : 'left',
		//minStatue : true,
		skin : 'green',	
		durationTime :false,
		stylewidth:'400',
		spacingw:30,//设置隐藏时的距离
	    spacingh:440,//设置显示时间距
	});
});
//面包屑返回值
var index = parent.layer.getFrameIndex(window.name);
parent.layer.iframeAuto(index);
$('.Order_form ,.brond_name').on('click', function(){
	var cname = $(this).attr("title");
	var cnames = parent.$('.Current_page').html();
	var herf = parent.$("#iframe").attr("src");
    parent.$('#parentIframe span').html(cname);
	parent.$('#parentIframe').css("display","inline-block");
    parent.$('.Current_page').attr("name",herf).css({"color":"#4c8fbd","cursor":"pointer"});
	//parent.$('.Current_page').html("<a href='javascript:void(0)' name="+herf+">" + cnames + "</a>");
    parent.layer.close(index);
	
});
function generateOrders(id){
	window.location.href = "Brand_detailed.html?="+id;
};
/*品牌-查看*/
function member_show(title,url,id,w,h){
	layer_show(title,url,w,h);
}
/*品牌-停用*/
function member_stop(obj,id){
	layer.confirm('确认要停用吗？',function(index){
		$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs " onClick="member_start(this,id)" href="javascript:;" title="启用"><i class="icon-ok bigger-120"></i></a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已停用</span>');
		$(obj).remove();
		layer.msg('已停用!',{icon: 5,time:1000});
	});
}

/*用户-启用*/
function member_start(obj,id){
	layer.confirm('确认要启用吗？',function(index){
		$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs btn-success" onClick="member_stop(this,id)" href="javascript:;" title="停用"><i class="icon-ok bigger-120"></i></a>');
		$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
		$(obj).remove();
		layer.msg('已启用!',{icon: 6,time:1000});
	});
}
/*品牌-编辑*/
function member_edit(obj,id,w,h){
    if (w == null || w == '') {
        w=800;
    }
    if (h == null || h == '') {
        h=($(window).height() - 50);
    }
    layer.open({
        type: 2,
        area: [w+'px', h +'px'],
        fix: false, //不固定
        maxmin: true,
        shade:0.4,
        title: '修改产品信息',
        content: '../html/product-edit.html',
        success: function (layero,index) {
            let body = layer.getChildFrame('body', index);

        }
    });
	// layer_show(title,'/html/editProductForm?productId'+id,w,h);
}

/*品牌-删除*/
function member_del(obj,id){
	layer.confirm('确认要删除吗？',function(index){
	    $.ajax({
            type: "delete",
            async: true,
            url: "/backstage/products",
            data: {
                "productId" : id,
            },
            dataType: "json",
            success: function (result) {
                if(result.status===1){
                    $(obj).parents("tr").remove();
                    layer.msg('已删除!',{icon:1,time:1000});
                }
                else{
                    layer.msg('删除失败,请稍后再试!',{icon:2,time:1000});
                }
            },
            error: function(errorMsg) {
                //请求失败时执行该函数
                console.log(errorMsg);
            }
        });
	});
}
laydate({
    elem: '#start',
    event: 'focus' 
});

//请求产品列表
function product_List(pn ,ps, input){
    $.ajax({
        type: "get",
        async: true,
        url: "/backstage/products",
        data: {
            "pn" : pn,
            "ps" : ps,
            "name" : input
         },
        dataType: "json",
        success: function (result) {
            processPageInfo(input,result)
        },
        error: function(errorMsg) {
            //请求失败时执行该函数
            console.log(errorMsg);
            // myChart.hideLoading();
        }
    })
}

//处理返回的product列表
function processPageInfo(input,result) {
    $('#total_num').text(result.total);

    var tbody = $('#search_result');

    tbody.empty();       //清空表格

    var child;           //展示数据
    $.each(result.list, function (index, item) {
        child = '<tr>\n' +
            '    <td width="25px"><label><input type="checkbox" class="ace" ><span class="lbl"></span></label></td>\n' +
            '    <td width="80px">' + item.productId + '</td>\n' +
            '        <td><img src="' + item.descriptionImage + '"  width="130"/></td>\n' +
            '        <td><a href="javascript:void(0)" name="Brand_detailed.html" style="cursor:pointer" class="text-primary brond_name" onclick="generateOrders(\'561\');" title="' + item.name + '">' + item.name + '</a></td>\n' +
            '    <td>' + item.categoryId + '</td>\n' +
            '    <td class="text-l">' + item.descriptionText + '</td>\n' +
            '    <td class="td-status"><span class="label label-success radius">已启用</span></td>\n' +
            '    <td class="td-manage">\n' +
            '        <a onClick="member_stop(this,\'10001\')"  href="javascript:;" title="停用"  class="btn btn-xs btn-success"><i class="icon-ok bigger-120"></i></a>\n' +
            '    <a title="编辑" onclick="member_edit(this,\''+item.productId+'\',\'\',\'510\')" href="javascript:;"  class="btn btn-xs btn-info" ><i class="icon-edit bigger-120"></i></a>\n' +
            '    <a title="删除" href="javascript:;"  onclick="member_del(this,\'' + item.productId + '\')" class="btn btn-xs btn-warning" ><i class="icon-trash  bigger-120"></i></a>\n' +
            '    </td>\n' +
            '    </tr>';
        tbody.append(child);
    });

    var page = $('#page');
    page.empty();
    var text;
    text+='<li><a href="#" onclick="product_List(1,10,'+input+')">首页</a></li>';
    //上一页
    if(result.hasPreviousPage) {
        text+='<li> <a href="#"  onclick="product_List('+(result.pageNum-1)+',10,'+input+')" aria-label="Previous">' +
            '<span aria-hidden="true">«</span> </a> </li>';
    }

    $.each(result.navigatepageNums,function (index, page_num) {
        if(page_num===result.pageNum){
            text+='<li class="active">' +
                '<a href="#" onclick="product_List('+page_num+',10,'+input+')"></a></li>'
        }else {
            text+='<li>' +
                '<a href="#" onclick="product_List('+page_num+',10,'+input+')"></a></li>'
        }
    });

    //下一页
    if(result.hasNextPage) {
        text+='<li> <a href="#"  onclick="product_List('+(result.pageNum+1)+',10,'+input+')" aria-label="Next">' +
            '<span aria-hidden="true">«</span> </a> </li>';
    }
    text+='<li><a href="#" onclick="product_List('+result.pages+',10,'+input+')">尾页</a></li>';
    page.append(text)
}
</script>
<script type="text/javascript">
    require.config({
        paths: {
            echarts: '../assets/dist'
        }
    });
    require(
        [
            'echarts',
            'echarts/chart/pie',   // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
            'echarts/chart/funnel'
        ],
        function (ec) {
            var myChart = ec.init(document.getElementById('main'));


            option = {
                title: {
                    text: '各产品所占比例',
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                toolbox: {
                    show: false,
                    feature: {
                        mark: {show: false},
                        dataView: {show: false, readOnly: false},
                        magicType: {
                            show: true,
                            type: ['pie', 'funnel'],
                            option: {
                                funnel: {
                                    x: '25%',
                                    width: '50%',
                                    funnelAlign: 'left',
                                    max: 545
                                }
                            }
                        },
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                calculable: true
            };
            myChart.setOption(option);

            // myChart.showLoading();

            $.ajax({
                type: "get",
                async: true,
                url: "/backstage/viewProductChart",
                dataType: "json",
                success: function (result) {
                    var names = [];  //类别数组
                    var labels = [];

                    if (result) {
                        $.each(result, function (index, item) {
                            names.push(item.label); //逐个取出类别并填入类别数组
                            labels.push({
                                name: item.label,
                                value: item.count
                            });
                        });
                        // myChart.hideLoading();
                        myChart.setOption({
                            legend: {
                                // orient : 'vertical',
                                x: 'center',
                                y: 'bottom',
                                data: names
                            },
                            series: [
                                {
                                    name: '产品数量',
                                    type: 'pie',
                                    radius: [10, 100],
                                    center: ['50%', '40%'],
                                    roseType: 'radius',
                                    itemStyle: {
                                        emphasis: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(128, 128, 128, 0.5)'
                                        }
                                    },
                                    data: labels
                                }
                            ]
                        });
                    }
                },
                error: function (errorMsg) {
                    //请求失败时执行该函数
                    console.log("图表请求数据失败!");
                    myChart.hideLoading();
                }
            })
        }
);
</script>